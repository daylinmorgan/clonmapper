# Contributing

## Setup

To make changes to the document you can clone this repo locally and use any plain text editor you prefer.

```bash
git clone git@github.com:brocklab/clonmapper.git
```

Alternatively you can make quick changes using the built-in GitHub
[VS-code editor](https://github.dev/brocklab/clonmapper-protocol).

### Requirements

> [!NOTE]
> If you submit your changes as a pull-request GitHub CI will generate a pdf for you.

At a minimum use should ensure you have `make` available.

Using `nix`:

Recommended to enable support for flakes and use `nix-direnv`.

Using `docker`:

Prefix all `make` commands with `DOCKER=true` or write it to `.env`

Otherwise:

To generate the pdf you will need `pandoc` (ideally version 3.1.11) and `tex-live`.
Additionally, the website will require `python3` and a `venv` with `mkdocs-material` installed.

## Generating the PDF

To make a new pdf you should only need to run the below command.

```bash
make pdf
```

This will generate a new pdf document at `./clonmapper-protocol-<rev>.pdf`.
If you make changes and commit them a new `rev` id will be appended to the file based on the `HEAD` of the repo.

## Generating the Website

To get started generate a python virtual environment to install `mkdocs` and its plugins.

```sh
make bootstrap
```

There are several `make` recipes for updating the website.
To start a development server with the website use the below:

```sh
make docs.server
```

Note that the latest pdf as well as any actual protocol markdown's
are auto-generated within the website docs and should not be edited by hand.
Some of the syntax used with `pandoc` is first removed (see `./scripts/pre-mkdocs-sanitize`),
as well as all the individual markdown's combined for the `./website/docs/protocol.md`

## Updating Tables

Tables are automatically generated from the `csvs` found in `./tables`.
Do not edit the tables generated by latex directly.
To manually regenerate the `latex` for a table you can use the included `make` recipe.
If you update the csv, `make` should regenerate the appropriate latex file for you.

## Updating Citations

Citations should follow the format `[@lastnameYYYY]`.
Any new citations need to be added to the bibliography in `./bib`

## Archiving Old Versions

If there is a major change to the protocol such as to the vector design or sampling
the previous version should be officially archived and listed as an entry in the [changelog](./docs/docs/changelog.md).
Additionally, its PDF should be copied to `./website/docs/pdf/archive/` and placed under version control.

